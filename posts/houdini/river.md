---
title: "River "
categories: ["Houdini"]
date: "2023-07-07"
created: "2023-07-07T15:27:00.000Z"
updated: "2023-07-07T15:45:00.000Z"
notion_url: "https://www.notion.so/River-8cf486d6c18b4baaa1d22164f5943566"
database: "Houdini Technical"
---

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/9cbbee53-2828-4220-9ebb-f14e1c1d34bb/Water.drawio.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=4fe88594b1b41368c6193d0bd27ecf9cb89f18f97d396cd6a8ba3d207ba46113&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

## 输入输出：

首先 ：
输入与输出有

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/eaedf371-860e-4188-bc2c-aa284d73780f/Image.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=2837c11c7b8da6f5e847c30b3ad440f90660b271eedafc95fc9907a5a1e30cca&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

![](data:image/png;base64,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)

![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARwAAACiCAYAAACTQ3JRAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABukSURBVHhe7Z3nkxXF24bf/8GfEQEFMWAoSkDArCiYA0ZQATNixISYMGBEDIgIKqgsqCVmMWJCTIggqCiiqBQIRREEiqDlh3m9mnqOs7Pd55w52xyX3fvDVcxMz8k913T3Us/9f/vuu28ihBDVQMIRQlQNCUcIUTUkHCFE1ZBwhBBVQ8IRQlQNCUcIUTUkHBFkp512EiIqEo4IQgfZa6+9hIiGhCOCmHC22GILIaIg4YggEo6IjYQjgkg4IjYSjggi4YjYSDgiSKXCueuuu5K3337b2yaaNiWFM3Xq1OSQQw7xttWHo446Krnwwgu9bXfccUfy/vvvJwMGDPC253lP5557bvLkk09623wcdNBB7vl9bU2NSoVz8cUXJyNGjPC2iabNfyYcRPDwww972/r06ZM89dRT0YQzduxYb5sPCedfNKUSsSlbOFyIr732WjJkyJDkjTfecNtHHnmkO+fuu+9O7rvvvuS5555L3nnnHTek5jijGIbW9lx33nlncuONNyYnn3xy8t577yUff/xx8vrrryfHHnts4RzjoYceyiWco48+OnniiSeSV199NXnzzTeTM844wx1HOBMnTnTS4Tj/Hnzwwa7thBNOSJ599ln3mDFjxhQ+p4SzEZ9wevTokYwcOTK58sork2+++Sb59ddfk8MPP9y1ffnll8kPP/yQLFiwIHn33XcLj+H7njZtWmEfXnzxxeS0005z29tss427+Xz33XeORx99NNlyyy1d29Zbb+1eh9/3iy++SH788cfkhhtuqPVcIY4//nj3ujxmzpw5ySmnnOKOczO74oorCufdc889yW233VbYHzZsWHLOOecko0aNco+bP39+stVWW7m+e//99xfO4z3S1rp1a7fP9/DZZ5+5z8B7Peywwwrnio3kEg4dih+C4w888EBy8803u22E8/jjjycHHnigO5cLu2fPnkHhsH355ZcHRziQVzjsn3TSSW77/PPPTyZMmOC2EQ6CPOKII9w+neimm25y28iGjsw2F9Att9wi4aQICef33393Fx4ySLelz0kLB2bOnJl06dLFbXOB/vzzzwWpcMEPHDiwcO7w4cOT/v37u21eY9WqVe7G1KpVq8I5pejYsWOyePHi5IADDnD7O++8sxMf2+UIB5GeddZZhWPA9/Hbb785+bCPMJ9//nm3zfN//vnnyS677OL2d999dydKe6zYSC7hpC9EOsjQoUPdNsK5/vrrC22Mdq677rqqCgcQDus/jHQYaXEsu4bTr18/N5pBNNyNGN0AHZqLSML5l5Bwvv7661rHsviEw+/9yCOPuO1Bgwa5PmNtjEC+//77wghn3rx5rg/RhnD++usv917s/HLgphJaRypHOPZesyCYXr16ue1JkyYlxxxzjNumny1fvrzwGQAx77jjjrUe39SpWDjXXnut6xRsZ4WDLK666io35bILHzalcC644IKkpqbGTZMQHR2e41nhXHLJJW6UQ0dJvzdDwvmXkHCyMsniO6d58+Zu1MD0afbs2cmee+5ZaPvpp5/c954+30A469at87YVY/DgwUHhMK2mb9m+TziM3m0/DTcqRvCMaJCkHT/vvPPc8fS5oi7RhMMUa7/99nNTF/7CxPyZx3z66aduLgvM2004jDRq/hGEPV+WvMJhdHL11Ve7baSSFs5LL73khtMMr5955hl3d+O9codCfJzH/PvQQw9108JPPvmk8LxNmZjCAS50RqCIPn2c327y5MlJixYt3D5TL9uuVDi8f6ZUNo3bYYcd3AiYbdYhn376abe9xx57JN9++23ZwgFGL/fee68bRdmxXXfd1Y1wWJ9kH7GGJNqUiSacmn/kwYX91ltvuQvazmMB+YMPPnDrJbfeemtBOFzcCIipDHNhO79v377uGAvKiIsFX2szeB90WqZrgDRYM+IYz8miIu+DcxHOuHHjnGg4xntGNrSdeOKJ7n2xxsPr0Fk4zhTrmmuuKbxeUyW2cJD533//7Rb008e33Xbb5MEHH3TrOlzMPNZet1LhAH2CdZS5c+cm06dPd/sc32233ZKvvvrKjazoa0z/8wiH0TzviVFO+ni3bt3cOg5TRCTGNZJuF2UIpxyyUyrROPAJR4j6IOGIIBKOiE0U4YjGiYQjYiPhiCASjoiNhCOCSDgiNhKOCCLhiNhIOCKIhCNiI+GIIAhHiJhIOEKIqiHhCCGqhoQjgviGxELUBwlHBKGDsGgsRCwkHBHEhOP7a4MQlSDhiCASjoiNhCOCSDgiNhKOCCLhiNhIOCKITzhU0csWnspD3pA8CqOdffbZ3rZyaNmypSv9SREuinvxuayNKoDLli1zhbPSjwlBWVpSKRYtWuTel+8cg1KkU6ZM8bY1ZUoKx1fOMwahIDxqElOomip848ePd50he06e95StaVyKbGXDpsymEE7ekLxSwiEloVg7tY2JnWGblAhLioDtttvOVaPs3Llz4Vg58HoSTmX8Z8JBBL4i6pR7pPQn29SetWSINHmFoyC8yggJh+PpY5sSLmyCEX1twIVNaVtfG1BattjjK6Ec4XBDlXDqUrZwuBCrGYQHVMIn7yp73CccOp6C8OISEg51p8koY2pB4oG1USuYfsHUhZq+jGasLRSSB0x76AfUGCYSZunSpa74Pm38dsTKMBIh9YH+RQ1ke86FCxcmq1evds8NFNCnjb7HPm2cwzbxMLRRwN/OX79+fdK1a1d33CgVaBcSDs9LXeZZs2Y50Uk4dcklnGoG4QHV/Mm/yh73CYd9BeHFJSQcfm+mJgTarVy5MmnTpo1ro+g9xfHZRgqkX+y99961Hu8rsE4Bc8uBIlnDZANc2PQh1lt4TZ4zHVDHdrERDo/PBtqlQShp4ZQTaOcTDoX5ETApEOxTQF3CqUsu4aQvxE0dhEeSA6JAYtk2n3BAQXhxKWcNh1A8fiMu0D///NONCgxSKi3O1/AJh77Ab/S///3PrdnNmDGj0MaFnV6jYf2HEY/txxYO/aVUoJ1PONzE0uF5WsPxU7FwNmUQHo8j0oUsaF+7TzgKwotPOcIhboXvjOnUH3/8UWtR1odPOO3atXOhckzD+O55PmvLCoe+lc4WJwXz5ZdfLuxnySuccgLtmFJmhUMEElE3ti/h+IkmnFhBeMyfGXH4/oJl+ISjILz45BEO29OmTXMBcYxU2M+ufYBPOIxKuWGkjxmlhMPvRQ4Uf3Finxwra4O8wikn0A6ZsLzA57TX4yb3yy+/uPxzjtMfJZy6RBNOTaQgPBb2uOBtmgPIwNqB98HohOkaIA0F4cUnr3BY72C0YYF2pFta8L/hE0737t2TtWvXukVjRjpIgBEybaWEA6NHj3bTNxZr02mYkFc4UCrQjlEcfWT+/PnuPPuMjOB5HzyGEb+EU5eSwimH7JRKNA58wtkUMApmWmX7xx13nLvY0+eIxoGEI4JUSziMiBnZzJkzJ5k9e7YbtTL99Z0rNm+iCEc0TqolHNF0kHBEEAlHxEbCEUEkHBEbCUcEkXBEbCQcEUTCEbGRcEQQhCNETCQcIUTVkHCEEFVDwhFBfENiIeqDhCOC0EFYNBYiFhKOCGLC8f21QYhKkHBEEAlHxEbCEUEkHBEbCUcEkXBEbCQcEUTCCUM5UQqGUWjsoosu8p4j6lJSOL5ynjGgJKOvjCiF0C0IjwqCvrrGed5TtqZxKbKVDZsysYVD5cZsdb3NEUqnUuid8qPs27+iNP+ZcBCBr4g6gqHAOdtEt/hkkVc4CsKrjNjCodyslQ7dnCFv67HHHvO2ieKULRwuxGoG4VHxjYLc9lxpfMKhsLWC8OKSFQ7V+KwSH98X2VPNmzd3dXw5Rl1pavzOmzfPYRExnTp1cqFzK1asSJYsWVIIoaO2NO2MELj5WCwL0byW/kCRcnKh+H2pP0zp0WxNYx88Z01NjcsUp5Igo2VqLtNG3WyqDNq5hPmRjWX7w4YNc/lrpHvwWGoXU7eYz8v75jPwWdjmO7HHkdPG++ezU2S9ffv2hTa+Jz4X759i6+SmcYy2YgGCjY1cwqlWEB6JDnRcpla8brbdJxz2FYQXl6xwkPWll16atG3b1l00fHfAxUI726QesN2lSxdXcN0eC3z3vhEOFzw5Z7Y/fPjwpH///m4b4axatcrdmEhEsHNKwU2M/mr79I9mzZq57XKEQ8pnqPg6j+WzZI/T5y09YsCAAbXysmr+kR/fn6U8UMDfpFpOgGBjIZdw0hfipg7C406KAHzTIZ9wQEF4cckKhzsv3x0pCnaR8rvbxcoogIuOQDhSMjZs2FBLEiHhcNenprGNcBgh0Ido4wIl/pf3kn1cMbjwSfDgoidrijhhaytHOOlQuywh4ZAOipDps0QQ8Vk4TmwM0ky/B6PcAMHGQsXC2ZRBeMb+++/vpJA97hOOgvDikxUOo5bp06e7i5HjiJpRIndr2idPnuxuEkwR2M9GyvA4ssNs3+CvPXzv2eOAcNatW+dtKwdGY/Q14mz69OnjjiEERiB2jk84jN5tP4tPOMQeI01mAEyVOnTo4KZctCGcNWvWJC1atKj1GCg3QLCxEE04sYLwkJItGvPjcYfKnuMTjoLw4pMVDhcOsbdIhn2mqkT9EoPLBcNd3C4qRpvr16+vJRwiepnq2r7lOfHbISt7LGKz7UqFwwiWuBnbRzCs5bHNOiSZWWyTBc66SX2FYyNmtvkueD4TDvDaPMY+MzdGJMV2OQGCjYVowqmJFITH+ssrr7ziZPDCCy8UwunS8D4YnTBdA6ShILz4ZIUDH330kfvjANuMWJj+WBu/74IFC9wi7+DBg90aSlo4TK/oCwTlISoTAusW/L8WC9DjZmGvW6lwWAOh//B+WPjlJtKxY0fXxqiCEQ8jK/of0//6CofPQAgga1t87t69e7vXtXY++/jx490CNJ+RPmnCKSdAsLFQUjjlkJ1SicaBTzhC1AcJRwSRcERsoghHNE4kHBEbCUcEkXBEbCQcEUTCEbGRcEQQCUfERsIRQSQcERsJRwRBOELERMIRQlQNCUcIUTUkHBHENyQWoj5IOCIIHYRFYyFiIeGIICYc318bhKgECUcEkXBEbCQcEUTCEbGRcEQQCUfERsIRQRqCcCjqRuU86hpTttN3zqZiypQpruC+r01URknhUJmPym5UYQMq+FFr2HdumjPPPNNbrS8PoeegjCmV/Ul2sHKkaci2ooJa9niIvPV8snWSGysNaYSDdHzCoQg5Rd2zx2NAEgkF2H1tojJKCodyh7fffrsry0lNYLJ1qL/qOzcNYrJ6wZUSeg4kSCejDq6Es+nYHIRDLWFGQdnjomFSVDgUeuaiTo9oKPBMYXRqHCODdPICOVKnn366S2wg5I6wO+rf0katYWre0jmoPUweM8fzPEcW8q/yCIecIWoYU8eW1+nWrZs7jnBGjx5dCPIjasYeQxoEz0X2EgXeOdaUhdOjR49k5MiRLseL2sXkN1GAnrZigW70JeoYU+eXfyl0b23UFk7LhP7VvXv3wj74hEPt4IULFyarV6927ZB+3hDUtqbIu+3vs88+rsYx2xbaB8uXL69T25jPSrF0PiPBfFwPxMNwLu0UZSc+iW1qdVv9Z7GRosIh+9t3YVF0nKlOSBZsczw9OkE4NoqgeDnFuItJi+3sc2TJKxySJEwyjNKINGEb4RDdygiOgvE8L++BuJmamhr3PjmP0R2Jnk1dOCQ3kLRgoW5GsUA3tvld2N5+++1dioY9rlLhADeRvCMcRED/sH3rZ+lzIFtMnYLwTOOZxrFP8XOkyzbZWnxWblBIleRPblDpgD9RQjh8eUypssftDpFXOHQ42ycZIa+0suQVDtNComdIbuB1RowY4Y5np1S0U8mf6vwffvhhISyPz03QWVMXDiOU9DEoFejGv8Sh8F0j8PRjqy0cYlxIT2jTpo0TA0kLFrubJiscfndGMunPiHyJySEVhL7FjYucK94/N+bs52jqFBUOMR5MadJTKr5A7lbkN1122WWFixbyCAdZMOLI8xxZ8gqHjsDIhlEOz8vUgONZ4ViQH8JJvzejqQuHPx6kj0E5gW6MiFhzIRmVuBiLxWV0wLTGzvMJh5A5n3B69epVa7RSLqwPEieEsCyjKktWOCwg0+fS5xhkohF1Q/+lT/LXLURmn1FspOSiMRcWaxq2aIzBuUBpY+GW7B/aGK2w5mKyYJTAj2XPg3CY07Pdt29flyeFyPI8R5a8wmHthrUEXovgvrRwskF+yJbnZurHFJDzyKvmXwmnrnAgFOiGhJhaMBJgn+kWeVEmEEaR5JGxjZBWrlxZRzj8ifrUU0912+mpHDc+hGUXdnaaF4Lp0MyZM12fsGlglqxwyE1nhEM/ZZ/RkY3WmIrTV+gXTBnp37Nnzy48VmykpHD4IkN/FkdAhHuxsMxoBBmZLBhC86Uz3OV8hEM7i4oE3dl5eZ6DY0AnoKPQwZEOHcPaAOGwoMdjDUZT3IUslI+/vKWFw2vzHpk2pYP8mFbynoFMatYeEA/Pkx6xNUbyCicU6IZw+E45xvSJ6VE6eA6xMxqYO3euEz/pnFnhcKNggZrnSC9GAwv+TN9mzZqV6//NMOVBOr42yAoHGB2zjoPkWBgnEJLjFtjH52R/xowZLuwu/VhRhnBikZ1SiYaPTzhC1AcJRwSRcERsqiYcsfkh4YjYSDgiiIQjYiPhiCASjoiNhCOCSDgiNhKOCCLhiNhIOCIIwhEiJhKOCOLrMELUBwlHBKGDMKUSIhYSjghiwvHNxYWoBAlHBJFwRGwkHBFEwhGxkXBEEAlHxEbCEUF8wlm8eLErtZk+lgfKm1AuxNfmY+LEifVKZWjZsqUrYULpC0pb8LmsjVrEy5YtcyUn0o8JQRkNSmssWrTIvS/fOQZ1fajh42trypQUTkOMiaHWMvVpqF1jhbPS7aECXCGyFf9K0ZQLcNVXONSyoYqir81HKeGUiokZPHiwq0XNNnV50hUJKdpFXaPOnTsXjpUDryfhVEZJ4TS0mBjeB8cpDIb4qCVLkaz0ORJOHELC4Xj62KaEC7tPnz7eNigVE0P/KPb4SihHOBTgl3DqUlQ4DT0mBqhTTNW19LGQcBQTk4+QcCgRS0QLUwu+f2srFhPD+UxHKC2arRjItIffhGqAJGwuXbrU9THauLAHDRrkRiJU/OP3oUSpPWcoJoYLnn3aOIdtKjbS1q9fv8L569evT7p27eqOG74omHR7SDg8L9UOqTyI6CScuhQVTkOPiWG0Q5oCCRLp4yHhKCYmHyHh8H0xNWndurWrP0z6AW3FYmIMX4lSyo0ybWeb38BkA1zYrPmw3sJr8pzcOKy9VGoDj0+fnwWhpIVTLArG8AmHvoiAyaVin5ughFOXosJp6DExCAwJZI+HhEOnUExM+ZSzhkNkDIXMS8XEGD7h8BvzfVJ8nRsC9YCtjQs7vUbDb8aIx/ZjC4ffNhQFY+f4hEMtZZMmaA3HT1HhNOSYGIb1DMMZkWTbQsJRTEw+yhEOiZWMAMuJiQGfcNq1a+diYJiGTZ06tZCEAFnh8NsQ72L7pWJi8gqnWBSMQd/LCoflAmJibF/C8VNy0ZgLq6HFxNDOaAMhZtsgJBwEpZiY8skjHLZDMTFpfMKhfzGaTh8zSgmnVExMXuEUi4IxkAnrR3xOez2m3yRPtGrVyh0nmVTCqUtJ4TS0mBj+RUpIgedCIiwG0mYgHDoSjzUUE5OfvMIJxcTYueATDqPmtWvXukVjRjr8dowwaSslHCgWE5NXOMAI2BcFYzCKY4pNeifn2Wfkjwq8Dx7DiFnCqUtJ4cQiO6USDR+fcDYFLBIzrbJ9Rpdc7OlzRONAwhFBqiUcRpSMbObMmePSKhmRMvL1nSs2b6omHLH5US3hiKaDhCOCSDgiNhKOCCLhiNhIOCKIhCNiI+GIIBKOiI2EI4IgHCFiIuGIIL4OI0R9kHBEEDoIUyohYiHhiCAmHN9cXIhKkHBEEAlHxEbCEUEkHBEbCUcEkXBEbCQcEUTCCUOxLcppUIaD+ty+c0RdSgqnIcbE8ANTB4faytSooZ5Juj1UgCtEtuJfKZpyAa76QHHybO2ZzREKi1EGleJc7Nu/ojQlhdPQYmKAgkwUwmKbIloUZEq3SzhxiC0cfk8rrLU5Q+VKCsX52kRxigqnocfE8F6I46AObfp4SDhUflNMTPlkhUOtGqtTM2bMGJfM0Lx5c1fljmM9e/Z0FfDmzZvnsALqnTp1cpEsK1asSJYsWVKIaOEmRjsjBPqAFS3npma1kSnhSWoCZT2pzkdhrmzFPx88Z01NjUvcpM4O/Y6KhLQxKqYGj51LrWuSI2x/2LBhrtj+qFGj3GOp7EdVPz4v75vPwGdhm+/EHkc5XN4/n50SpO3bty+08T3xuXj/lCKdMGGCO0ZbsXidxkZR4TTkmBhGWdOnT0+GDh1apy0kHMXE5CMrnLFjx7rUirZt27qLBgkAFwvtbFMTmO0uXbq4cqT2WOAC9o1wuOAHDhxY2B8+fHjSv39/t41wVq1a5W4S1Au2c0pBGVguetvnd23WrJnbLkc4ZGCFSpPyWD5L9jjCtdrKAwYMqJUmUfNPP+L7sxrIXAMm1XLidRoLRYXT0GNiWBPgRyQ2JH08JBzuqIqJKZ+scLjzMrJhSmsXKd+bXayMArjoWPNj5Llhw4ZakggJh7s+Ff9shMMIgd+ANi5QwvF4L9nHFYMLnz7HRc8ImLA9aytHOOnIlywh4ZCdRf+gT06aNMl9Fo5TVB1ppt+DUW68TmOhqHAackyMQYxrzT93j/SxkHDoWIqJKZ+scBi1MKrkYuQ4EmaKyt2adqbfjBqZIrCfLbjO4yhkb/sGf+3JJiMYCGfdunXetnJgNMZvTbF3i/xFCIxA7ByfcJge2X4Wn3AIBUSa3NCYKnXo0MFNuWhDOGvWrElatGhR6zFQbrxOY6HkojEXVkOKiWGxmOM2zWFdJbuIHRKOYmLykRUOFw6hcEiGfabWBOEREscFw13cLipGwMTopoXDSJS1C9u3tAMiVZCVPRax2XalwmF6x29o+wjGsqSGDBniRu5sk5TJukl9hcPrEQ/MNt8Fz2fCAV6bx9hnph8iKbbLiddpLJQUTkOLiYHBgwe7zg7crXx/FldMTP3JCgcQMIvrbNMvmP5YG38UIDucRV5+I9ZQ0sJhesX3RowMojIhsG7B/2uxeBn6mb1upcJhDYQbGe+HhV9G5R07dnRtjCoY8TCy4ibE9Lm+wuEzcJNjbYvP3bt3b/e61s5np5+zAM1nHDduXEE45cTrNBZKCicW2SmVaPj4hCNEfZBwRBAJR8SmasIRmx8SjoiNhCOCSDgiNhKOCCLhiNhIOCKIhCNiI+GIIBKOiI2EI4IgHCFiIuEIIaqGhCOEqBoSjhCiakg4QoiqIeEIIaqGhCOEqBoSjhCiakg4QoiqIeEIIaqGhCOEqBoSjhCiSuyb/D+H4a4cN0pAkQAAAABJRU5ErkJggg==)

支持最小输入两个、最大输入3个分别为：河流原始流向曲线、地形、河流水面Mesh
支持3个输出分布为：最终结果预览、地形、河流水面Mesh

### 设置曲线：

首先去曲线进行resample细分，保证曲线密度均匀，使用jitter在xz平面抖动曲线，把曲线吸附地形与水面上，比较曲线0point与@numpt-1高度，确定曲线头尾，保证水流从高到底流向。如果有输入3其他水面，提取输入3水面中的引流线与曲线的头尾点做距离判断，如果距离过近认为两条河流相交将曲线自动吸附再其他河流曲线上。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/8dcb73f8-18fb-40ec-a48c-c7a42ac2ef89/%E9%9A%8F%E6%9C%BA%E6%8A%96%E5%8A%A8.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=750a5e43bc7ebd33e6a0b23090f6d2422aeb6fafaf7ef96ce22aad6ee8c11f06&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

为了避免曲线在太过陡峭的地形在生成河流，我们可以循环对河流曲线做沿着地形坡向滑动操作避开陡峭区域。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/8d57cf29-d776-4b93-92a4-48ea60ac5e7c/CurverSlide.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=b13fb0c30cfec07eca49a7c6b1b577d54ef235766cf0c2b44c2fcb387f146d3b&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

最后还需要贴合地形与水面一次，并且保证曲线从高到低，上一个点的高度必须大于或等于下一个点。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/4b50e3a2-b506-40d4-9b8b-e756a039871f/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=3e02d695b6df7bf74fd2d50eab23064a8d69e076986bdbd79f64a993639a3308&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 生成瀑布：

进入生成瀑布节点可以先使用resample均匀曲线密度，然后根据曲线坡度(斜率)选择瀑布，直接用Group节点就能实现，

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/14ee9f61-a023-4165-83c5-eb2ec0465f50/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=f242b7d76bd822863bbab07a52d38d497e833abf3ecd8e682e043a3dfe6f1e39&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

通过指定瀑布的起点和终点得到两两配对的瀑布点

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/edd916ae-9396-4e10-813d-eea2c0ac12c5/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=080bd522251fb009a6096e6cf405e611fbc852cdea50b77ea335512091addd40&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

根据瀑布的起始点与终止点，我们可以得到当前瀑布端的长度和位置，我们可以根据需求删除过短和距离过近的瀑布，之后我们需要调节瀑布的坡度，就是再曲线上滑动瀑布终止点位置，这个对于生成的瀑布只能做到全局调节他们的坡度

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/a2e090cb-e142-499b-bc2a-f17ecdb22731/Curver.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=85eaa53c3c2579182fa32753e2b0bb498f5aa6e7bbc4f94542cda7c2df3d6d75&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

之后我们还需要支持人工设置瀑布，一个Multiparm Block(List)来存瀑布参照

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/9b2d79eb-1de8-47a3-a127-a1e1be5ed5dd/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055011Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=e8b7b7cd6c1e8ca3de00cbc355b6421122dcf09bdbe911a91a2318fc7de5c0b9&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

使用循环遍历来应用上每一个瀑布，保证最后瀑布终止点不低于河流最低点，最后保证每个瀑布高度不低于一个阈值既可。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/f5fb064f-bad8-4c84-81cb-055899b705a5/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=0cc2125803ced29f21d0b6a81d4640136b6358e1226701ab7f50444608407e05&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 设置河流属性：

我们需要模拟流水侵蚀的两种主要形式(溯源侵蚀可以不做):下蚀、侧蚀作用：

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/1b22ce2c-da78-4251-b52d-e01204edb29e/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=0f0a9d85947d42bdb4248cce7e5b6641eee47790e59b198e53225d0e4dbe90b1&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/fb725c35-6c02-4eb6-a4d5-784cbd5adeef/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=1dfe8f64a59f94c0337048db078e3126ca8b167a34203521c9f5889101cc51df&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

下蚀很容易，就只需要根据侵蚀力度加深河流深度既可，侧蚀的话需要先定义一个 -1到1 的noise，用来向左或者向右扭曲河道。需要注意的是侧蚀操作要避免河流的瀑布区域还有头和尾扭曲。
之后我们还要计算河流的切线方向、河道下挖的方向以及河流的斜率等你需要的信息，为了计算精度，我们可以先提高精度计算然后再转移到现有曲线上。

```c#
vector forward = normalize(v@tangentu);
vector right = normalize(cross(forward, v@up));
v@depthDir = normalize(cross(forward, right));
```

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/65516149-cd61-4e0d-a648-0e748d3999d5/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=17260bad9010f175fe2f18077488d7d7b6dc4fe41e99513157ab61d3a42db594&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

设置完这些之后，我们可以设置河流的宽度以及深度，这里我喜欢通过Ramp图参数以及一些额外的noise来控制整条河流的宽度与深度，注意河流的宽度还和河流的斜率有关，这里我们为了模拟水流越平缓越宽阔、越陡峭越细窄的特点还需要乘以一个河流的坡度。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/d8a3c6cf-b394-4b59-bda0-fcaa62c9256e/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=1f36534bee30c2071a8801ffd12c4f31557605b6ca355b10c7893a4caf46c162&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

这里ramp大小可以超过0到1.

### 转换为河道曲线：

这里要注意看看我们参数列表

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/3bc63907-1f9c-4356-8ed4-bee67db1f59c/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=8f9afe5dda25a9ce8159503500f5c674f96f40b40bfa74081a8b0e201cadef00&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

河道我们可以理解为一个拥有八个顶点的线段，一共四个宽度控制，0、7点为河流的总宽度，1、6点为河岸宽度，2、5点为河面宽度，3、4点为河底宽度，线段通过copytopoints生成在河流曲线上，通过河流曲线顶点上的pscale参数控制线段大小(顶点处当前河流宽度)，

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/b9b575f4-d89b-4f8b-8dd5-61ccbc4d31fa/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=fc6b7e99122824053538daf229596b71dab4add44e39d1665e9efa483ad99fb7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

### 曲线重叠修复：

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/eca86ce3-2713-4d01-b06a-02bd96b09b72/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=eccfed7f0055779ac18cb07318809f71b0a83e8c80291dbe776758a0cdeb4bc0&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

思路主要是用找到曲线自身相交的点，提取相交打结的点，把点均匀分布在离相交点最近的两个点之间。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/aa2238c7-3d0f-4f79-a3c6-f70bec32f84f/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=9c05f3b26ac0f1daec31122d1489292f16efa2d5a0b728035fb2f1586a35d422&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

使用intersectionanalysis节点就能得到相交的点，打开PrimitiveUVW就能得到相加uv范围。你得到相交点 uv之后，你就有一个 uv 区间。

```javascript
@maxu = max(v[]@sourceprimuv[0].x,v[]@sourceprimuv[1].x);
@minu = min(v[]@sourceprimuv[0].x,v[]@sourceprimuv[1].x);
```

你就可以将 这个 uv区间的点得到给他们上一个 fix的属性标记，之后就可以将顶点均匀分布在 fix-1 到 fix+1 顶点这个区间。

```javascript
int minpoint=0;
int maxpoint=0;
float fixNum = 0;
float curFixNum = 0;

for(int i = 0; i < npoints(0); i++){
    int pointfix = point(0,"fix",i);
    if(pointfix==1){
        minpoint = i-1;
        break;
    }
}

for(int i = npoints(0)-1; i >= 0; i--){
    int pointfix = point(0,"fix",i);
    if(pointfix==1){
        maxpoint = i+1;
        break;
    }
}

for(int i = 0; i < npoints(0); i++){
    int pointfix = point(0,"fix",i);
    if(pointfix==1){
        fixNum++;
    }
}

vector pA = point(0,"P",minpoint);
vector pB = point(0,"P",maxpoint);
vector dirATB = pB - pA;



for(int i = 0; i < npoints(0); i++){
    int pointfix = point(0,"fix",i);
    if(pointfix==1){
        curFixNum++;
        
        vector pos = pA + float(curFixNum/fixNum) * dirATB;
        setpointattrib(0,"P",i,pos);
    }
}
```

注意如果要计算线段UV，使用UVTexture节点需要把textuerType改为Rows&Columns.

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/8471dda1-481c-46b5-a3f2-463e1a7d69a6/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=2004c2770d4b75a8c7202a2caaeff60c44c792b9351a52bda7c6676d383a3143&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

### 设置河道曲线：

得到修正过后的河道曲线之后，我们可以开始做河道的扭曲(侧蚀)啦，我们提取河道中间的四根曲线，根据我们在河流属性设置哪里产生的侧蚀Noise来做扭曲，扭曲方向沿河流的切线方向(在河流属性设置步骤得到)，还得保证了河流只在河道内做扭曲不会超出河道。

```c#
vector B = normalize(cross(v@tangentu, {0,1,0}));
B.y = 0.0;

float factor = @meandering_factor;

@P += @pscale * B * factor * 0.45;
```

接下来我们调整整条河流的高度已到达自定义控制河流的高度，

```c#
float depth = chramp("floodplain_height",@curveu);
@P += {0,1,0} * depth;
```

然后我们使用当前河道与输入三的其他河流水片做一个高度匹配融合，在一定范围内当前水片匹配输入水片高度之后在慢慢lerp回原来高度。
我们需要遍历每条河道曲线，去设置他的宽度。注意我们需要把宽度控制在上一级宽度之下，0以上。河流宽度 > 河道宽度 > 河面宽度 > 河底宽度.

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/867640d9-a15f-4ee8-bad2-7665b91d200a/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=6399a2b92b0aa1d7fb2fae13d0ebd25f4abe8689bf26311d3d0e7ea5734fe6c7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

### 下挖河道：

设置完每条曲线的长度值之后，我们就要开始下挖河道辣，3、4点为河底，所以我们只需要把这两个点沿深度下降方向即可(属性在设置河流曲线属性存储)。顺便把曲线的0、7点设置权重为1(这个权重值主要是后面与地形融合的权重)。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/e219f637-1466-4e4b-9313-1ac40fdfb59a/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=6fb4e318b1dbc2b3ff9f8bca7e8185a3d31ef6b1ac62a2f04e2e847df9932f78&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

挖完河道之后我们可以使用Skin节点把曲线转换为我们需要的河道Mesh，给上Normal节点，现在的河道Mesh还过于简单啦，我们还需要使用remesh或者subdivide细分一下mesh，到达同等密度网格时，remesh的消耗要大于subdivide，但是remesh细分不规则网格效果比subdivide要好的多，这里我们结合一下，我使用的是 先remesh一次密度为2或者1都可，smoothing暂时为0(需要和水面高度保持，现在不能形变网格)，remesh之后接一次subdivide，depth为1或者2都可以，这样得到的网格颗粒度都比较均匀，注意在remesh之前我们需要使用clean节点保持网格的干净，剔除可能错误的值 比如：nan
接下来我们就要考虑网格的平滑和不规则的噪声，这里我使用一个attribblur和mountain来操作，但是，这两个操作使我们的网格不太可控，容易出现水面高出河道网格的现象，为此我们需要做一个权重来控制网格形变的大小，权重大小可以根据水片曲线边缘的两条曲线与地形mesh的距离得到(P.y等与0)，根据权重lerp原始未形变的河道和形变过后的河道，既可保证河道高于水片。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/657f4766-aeff-4f08-a341-e905fdd90fc7/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=505beb4fffcdec128fdc5d56f1becc8f1ca1a409f19d8fa5cfea21343b3d4460&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


### 下挖地形：

下挖地形我们前先，我们需要把下挖权重(下挖河道处设置)映射在地形上做为权重Mask，

```javascript
vector up = {0,1,0};
float maxdist = 10000.0;

vector hitpos;
vector hituvw;
int hitprim;
vector raydir = up * maxdist;

hitprim = intersect(1, @P-raydir*0.5, raydir, hitpos, hituvw);
if (hitprim >= 0)
{
    vector p = primuv(1, "P", hitprim, hituvw);
    float weight = 1.0 - primuv(1, "Weight", hitprim, hituvw);
    float h = weight > 0.99 ? p.y : @height;
    vector origin = hitpos;
    @mask = weight;
    @height = lerp(@height,p.y,@mask);
}
```

对于地形下挖我们常遇到的就是转角处高度错乱，我们通过提前处理Mesh可以避免，这里我们再加一次常用的处理操作，就是第一次hit打中后继续向上检测一次，如果还打中，那么说明这个地方mesh重叠，我们需要把当前位置Mask设为1，没有重叠的就是0。然后根据mask轻微blur之后进行heightblur操作。

### 设置地形属性：

这一步我们需要提前我们做地形地表时候需要的mask信息，我们可以得到我们想要的一些信息：比如河岸、河流区域等等。。这一步看个人啦。
在把做好的Mask信息与输入的地形原有Mask做Max叠加。输出既可。


### 设置引流线

我们将 转换为河面曲线 过程中由2，5号曲线得到的河面线段，通过Remesh固定数量2 再通过skin转换为3条河流曲线，我们提取其中的1号曲线就是我们的河流引流线啦，得到引流线我们resample为一条密度比较均匀的线条，删除其中冗余的数据，并且为自己打上Tag就可以啦。

### 转换为河面曲线：

在设置完河道线段之后，使用skin的columns后，提取线段的所有2号、5号点组成的曲线，也就是河面，再次skin得到河面线段，现在的河道线段只有两个端点生成的mesh太过稀疏，为了mesh的密度均匀(密度均匀shader做WPO效果比较好)，我们可以对河面每条线段做resample操作，这里的resample可以自动适配也可以固定数目。自动适配就用measure计算每条线段的长度，通过attribpromote可以得到平均长度，再通过参数取得我们之前resample河流曲线的间隔密度。有了这两个参数就可以算出resample的值啦。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/0877ce6d-2015-4914-95ef-614b5118dd3e/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=3a93d7cd041be4294ea6dbeeddb31a7577d391f7d67a7d0fa33703c625c0ceb2&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

### 设置河面属性：

我们需要用skin把河面线段又转换为河面曲线，然后提取河面曲线两侧边缘曲线，0号与`nprims(0)-1`号点，使用ramp参数动态扩张两条曲线任意位置。

```c#
//int值最后会四舍五入
int inum = @ptnum / @numprim;

vector p = point(0, "P", inum * @numprim + (@numprim-1 - @primnum));
float water_depth = chramp("waterSurface_expansion",@curveu);
@P = p + (@P - p) * (1.0 + water_depth);
```

接下来需要与输入的水面做贴合，水面附近也需要渐变贴合。

### 设置河面UV

河面UV的核心算法就是把UV合理的分布在0-1空间里，也可以根据河流长度缩放河流的uv.x

```javascript
@uv.y=@ptnum % @numprim / (float)(@numprim-1.0);

@uv.x = (@ptnum/ @numprim)/(float)(@numpt / @numprim);
```

uv缩放可以使用uvtrnasform 或者 vex，配合measure节点，主要代码为
detail("../length/", "perimeter", 0) / detail("../width/","perimeter", 0) * uv.x;
我这里选择使用第一种0-1空间的uv，作为主uv，第二种放在uv1上。

### 转换为河面Mesh

通过skin变为河面mesh，给上normal节点，注意顶点顺序会导致河面法线可能向下，通过attribpromote节点把法线平均值传递给detail属性，判断N.y是否大于0，从而得知法线是向下还是向上，如果向下使用erverse反转顶点既可。

### 设置河面Mesh

这里我们需要把当前水面与输入的水面做一次粗略的剔除，并且也可以选择性的剔除超出地形的水面Mesh，做粗略剔除时，注意要把两边mesh的P.y都归到0的位置，这样可以去除Y轴导致的偏差，在后面boolean的时候也会用到这种方法.
使用xyzdist()判断每个顶点是否与输入水片相叠，如果相互重叠那么我们标记这个顶点，之后我们在遍历每个prim，判断这个片元的每一个顶点是否有这个重叠标记，如果当前片元里面所有顶点都满足重叠，那么我们可以删除这个片元。
为了保证水面贴合，这里我们可以再做一次贴合水面的操作，并且重新再计算一边法线。

### 输出水片

输出水片这一步我们需要清理水片Mesh的一些冗余信息，并且设置我们需要的信息标记当前Mesh，比如当前Mesh的name等，名字我们可以使用 $HIPNAME+`opname("../../../")` +`opname("../../")`获得当前唯一ID，这个可以作为Mesh的name，完成之后与河流引流线合并，并Pack起来设置Tag后输出。



最终输出的时候我们可以地形和水面merge起来输出到 output0来显示，实际数据用output1与output2传递，这里我把顺便把输出节点颜色改变一下，使用相同颜色对应相同颜色连接。就此我们的河流HDA完成。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/0b6fedf8-0cbe-473c-a286-6764b8d7964f/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466U56BTPXQ%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055012Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIEwLXP9P2a3gOpTW8I0%2B5RrFKkqfh7PjDFwACkq0Hc52AiEAsPccGsaYmnq8924yVK%2B0ApeqU7HHCU3A4xHyx5wKZdwq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDOpnx90D12BxuoM3FyrcA%2B5qzIAgbiU0PZZS2hhJlsDBdFgbiJTgmbb7KJvr8%2BBicYBFwpAo3ExMrGHgiGhGAbZXwGC7aAL2vU7ZR3aHB4eCnbnOFbVfjqQA9fK7WmptHfQEQJYwEeo5St5ngJk2yZyASWwn5VdlmJ8sPsOexb3vvMr8WqnDfGB1G8nVvoJw3xjEIJVHuF%2Ba4ukGUPlVBKIKsNYDK%2F%2BRqHEdQGzx1wJW876xr5Y8OJMDwoU73sOxvfRrkegIvksYsnXC%2FPBhWjjsOW4KZBAHRvYMp6AQIMBENrUORft8KVNhRSr6%2FmtrrX27ijCV8mP1%2BsyxA1moce04CWwlUV9HlXXXze%2BrF2Kb4SrFteTTLgB4SAX%2FJlodu%2F29mAaZBYuY8iSG16GTl3EQle3rdN3ewlq8LUthAv97YKh3w3XXNuy5R2%2Ftn0JW%2B0%2FgF%2B2wzP0GALd8TzK9jo1Do5GMOXP8hH8Wt2GacHKF96HHdfCXAmk2TGi9PX%2F6uyxMF0dZEFPsVbkB4%2BOgDepJOpt3qLi7Lz1wN5C5xyJKb5m62KHFtfk4MwoT4P8MHAzTsbZor7FWbWVwaHkODrvK6bGB4t1y6mUKhCiPbTLh3mZ8nT9AKpjMZX4ni%2F4syqbwk%2ByRK0S9%2Fjt2MO2V1cwGOqUB%2BgKUKKfoiVtYqu9YUWthvmyxXi2FIY0d3e8nHVx5Wzs70a%2BfyMfsmOqmELW9%2F73AfeGEZ2N61RmOr62EBmsU4CmMv9dDsnnxNAY2QR5UUb7x9oJnLaJ8idys9I3Yq3vSVO%2Br8n44MOifFYiOyD8znm%2FOjwui3THubaRuZDiFWFyMzNBahxtxfaTAiRjpp2b2f2lOEr8V8zhxbkRAfZejXPjotfsF&X-Amz-Signature=9542c3c4b37a54abbf7de75f0527b664e6f39a0d3b603c988c4b69bae4a77dfb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


