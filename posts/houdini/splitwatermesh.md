---
title: "SplitWaterMesh "
categories: ["Houdini"]
date: "2023-07-07"
created: "2023-07-07T15:27:00.000Z"
updated: "2023-07-07T15:53:00.000Z"
notion_url: "https://www.notion.so/SplitWaterMesh-c0bb556233134e00b57622da264ee81c"
database: "Houdini Technical"
---

裁剪水面分为两大类型，一种是以小块InstanceMesh来拼接成水面，(以前的Unity地形便是如此)

另一种是以地形划分的Cell为单位，切割为一块一块StaticMesh。这里我们通常使用第二种。

得到boudingbox有两种简单方式，一个就是bound节点，另一个就是Labs的multi_bounding_box节点

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/08ccb769-b4d7-443d-9d9d-9a58c1fae163/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466W2DDH772%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055014Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFyZraOBpLeWx2APj9XPRhdrWQf%2FjO6CP4SryJl7CGawAiAccmNVbm1GpQuVPDY99no8UXg5r8kjn0Ri%2FAYfdqGFBCr%2FAwheEAAaDDYzNzQyMzE4MzgwNSIM%2F0yMkECMl28HDBShKtwDWM%2FmljeKeT8tWyIHQ9RvmJDCiBC5GhTXXD6hUxml5stg43KajUHOwnOme%2BIG4Ip1u1eT9BQT1laJt9YFOOkg%2BzyEZZICWfsMTuyoqsq%2BcDRMhcBojqngoa3lj8Ze2Ypxd63VcEhkzmHXxDD3l8N3GvYxd%2FjvdiCh5xXRyMWP8y%2FYvXAbKlj7oWgMiMKBRzZm06AHCQS6QxypQVYRnRzoaObrFWr%2FKyeoLZ7d%2FuMjoqNYFmDPT0onFub2Ac7CF4l0HdOe2YFhTwebS16Cb%2BVDkeM0fBtEKfCLqmR8JJhjI3r7%2Fd3dS6llElAvEVzTD1aZ4Mp34BEGfoJey%2FFqsAwUzctiYfOdqI%2FB%2BuiuJd9jYoW070tg31ARBY0qLhFxnczfi39RXoY6cA7vBFrxFkWYI5gq2Cpw0UPXOUnCxMZdOZGGPmS0vCJmMiH2AUIrFe91ZrDvY2HuW1f29BN1CLEiahi9hb6XSf7%2FxdcFAkk1rsoU3r%2FA7Fj%2FYDFY%2BNP3%2FNIpasF8mJZjtfFFfV%2FwkGlR3srVjZb94kpAyGrOPuepbpCtl98RLI%2B6hgA%2BEBRkp1PAB6O8JMYw0sI30sg4WP5BWXvMuFwkJ0T6haWl3oaHBRh32M5EWErFRfC%2Bp%2BAw%2B5XVzAY6pgHUhYqkjJecw8NbVmyhC0VirwB%2FFWUxf7b9ZhnVRxOpiKVtMLfJG49MXafJWGZyMjS08U8l6wTpjm4RbUPU9Tw8%2FCuCgRhmCxI6ZGwzR2%2BgapDrwok4AJR2xxK39hSC%2BNRQtBSKSn4wOVVFPVmmWhaH6Kgk77eZvdJRXShyFqUFvkBLb0ZlsxHo4371CFQLU4NNqmTD8edDnPosSaZFsJw3%2BcszENW3&X-Amz-Signature=32f0c93106f1669c116d8461924327b05bf6fa5da164f6cc17ebd9f131123f34&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

这部分其实很简单主要是根据我们地形具体streaming的包围盒大小，作为我们裁剪使用的boundbox，遍历每个包围盒，然后嵌套遍历每条河流， 对每条河流做Boolean操作，取Intersect部分，这样就可以得到根据地形Cell划分的水面Mesh，最基础的功能这里就已经实现啦。

这时候按5键可以看到我们UV大概会只占据0-1之间的一部分。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/5d47d6f9-bd28-4f63-8539-c58cab611679/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466W2DDH772%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055014Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFyZraOBpLeWx2APj9XPRhdrWQf%2FjO6CP4SryJl7CGawAiAccmNVbm1GpQuVPDY99no8UXg5r8kjn0Ri%2FAYfdqGFBCr%2FAwheEAAaDDYzNzQyMzE4MzgwNSIM%2F0yMkECMl28HDBShKtwDWM%2FmljeKeT8tWyIHQ9RvmJDCiBC5GhTXXD6hUxml5stg43KajUHOwnOme%2BIG4Ip1u1eT9BQT1laJt9YFOOkg%2BzyEZZICWfsMTuyoqsq%2BcDRMhcBojqngoa3lj8Ze2Ypxd63VcEhkzmHXxDD3l8N3GvYxd%2FjvdiCh5xXRyMWP8y%2FYvXAbKlj7oWgMiMKBRzZm06AHCQS6QxypQVYRnRzoaObrFWr%2FKyeoLZ7d%2FuMjoqNYFmDPT0onFub2Ac7CF4l0HdOe2YFhTwebS16Cb%2BVDkeM0fBtEKfCLqmR8JJhjI3r7%2Fd3dS6llElAvEVzTD1aZ4Mp34BEGfoJey%2FFqsAwUzctiYfOdqI%2FB%2BuiuJd9jYoW070tg31ARBY0qLhFxnczfi39RXoY6cA7vBFrxFkWYI5gq2Cpw0UPXOUnCxMZdOZGGPmS0vCJmMiH2AUIrFe91ZrDvY2HuW1f29BN1CLEiahi9hb6XSf7%2FxdcFAkk1rsoU3r%2FA7Fj%2FYDFY%2BNP3%2FNIpasF8mJZjtfFFfV%2FwkGlR3srVjZb94kpAyGrOPuepbpCtl98RLI%2B6hgA%2BEBRkp1PAB6O8JMYw0sI30sg4WP5BWXvMuFwkJ0T6haWl3oaHBRh32M5EWErFRfC%2Bp%2BAw%2B5XVzAY6pgHUhYqkjJecw8NbVmyhC0VirwB%2FFWUxf7b9ZhnVRxOpiKVtMLfJG49MXafJWGZyMjS08U8l6wTpjm4RbUPU9Tw8%2FCuCgRhmCxI6ZGwzR2%2BgapDrwok4AJR2xxK39hSC%2BNRQtBSKSn4wOVVFPVmmWhaH6Kgk77eZvdJRXShyFqUFvkBLb0ZlsxHo4371CFQLU4NNqmTD8edDnPosSaZFsJw3%2BcszENW3&X-Amz-Signature=82731e7db4c050654c772d292521c12ba84629565a371c688c241fd50d28d34c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

注意有时候按5键，界面是黑的什么都出不来，这时候我们可能需要刷新下界面，heightfield有时候显示出错，同理也可以使用刷新既可。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/1eb146b3-8916-464f-9fef-aa1a01c90c1e/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466W2DDH772%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055014Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFyZraOBpLeWx2APj9XPRhdrWQf%2FjO6CP4SryJl7CGawAiAccmNVbm1GpQuVPDY99no8UXg5r8kjn0Ri%2FAYfdqGFBCr%2FAwheEAAaDDYzNzQyMzE4MzgwNSIM%2F0yMkECMl28HDBShKtwDWM%2FmljeKeT8tWyIHQ9RvmJDCiBC5GhTXXD6hUxml5stg43KajUHOwnOme%2BIG4Ip1u1eT9BQT1laJt9YFOOkg%2BzyEZZICWfsMTuyoqsq%2BcDRMhcBojqngoa3lj8Ze2Ypxd63VcEhkzmHXxDD3l8N3GvYxd%2FjvdiCh5xXRyMWP8y%2FYvXAbKlj7oWgMiMKBRzZm06AHCQS6QxypQVYRnRzoaObrFWr%2FKyeoLZ7d%2FuMjoqNYFmDPT0onFub2Ac7CF4l0HdOe2YFhTwebS16Cb%2BVDkeM0fBtEKfCLqmR8JJhjI3r7%2Fd3dS6llElAvEVzTD1aZ4Mp34BEGfoJey%2FFqsAwUzctiYfOdqI%2FB%2BuiuJd9jYoW070tg31ARBY0qLhFxnczfi39RXoY6cA7vBFrxFkWYI5gq2Cpw0UPXOUnCxMZdOZGGPmS0vCJmMiH2AUIrFe91ZrDvY2HuW1f29BN1CLEiahi9hb6XSf7%2FxdcFAkk1rsoU3r%2FA7Fj%2FYDFY%2BNP3%2FNIpasF8mJZjtfFFfV%2FwkGlR3srVjZb94kpAyGrOPuepbpCtl98RLI%2B6hgA%2BEBRkp1PAB6O8JMYw0sI30sg4WP5BWXvMuFwkJ0T6haWl3oaHBRh32M5EWErFRfC%2Bp%2BAw%2B5XVzAY6pgHUhYqkjJecw8NbVmyhC0VirwB%2FFWUxf7b9ZhnVRxOpiKVtMLfJG49MXafJWGZyMjS08U8l6wTpjm4RbUPU9Tw8%2FCuCgRhmCxI6ZGwzR2%2BgapDrwok4AJR2xxK39hSC%2BNRQtBSKSn4wOVVFPVmmWhaH6Kgk77eZvdJRXShyFqUFvkBLb0ZlsxHo4371CFQLU4NNqmTD8edDnPosSaZFsJw3%2BcszENW3&X-Amz-Signature=0ca5af9ddbd39e29fa4b6bf6eaa46a2b077570796a4a88500d7cfffcf508a73b&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

当我们UV只占0-1之间一部分时候，有些精度就浪费了，这时候我们可以通过uvtransform来把uv自动移动与缩放。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/3fdf4d8c-8046-48f6-973a-feb9d098b312/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466W2DDH772%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055014Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFyZraOBpLeWx2APj9XPRhdrWQf%2FjO6CP4SryJl7CGawAiAccmNVbm1GpQuVPDY99no8UXg5r8kjn0Ri%2FAYfdqGFBCr%2FAwheEAAaDDYzNzQyMzE4MzgwNSIM%2F0yMkECMl28HDBShKtwDWM%2FmljeKeT8tWyIHQ9RvmJDCiBC5GhTXXD6hUxml5stg43KajUHOwnOme%2BIG4Ip1u1eT9BQT1laJt9YFOOkg%2BzyEZZICWfsMTuyoqsq%2BcDRMhcBojqngoa3lj8Ze2Ypxd63VcEhkzmHXxDD3l8N3GvYxd%2FjvdiCh5xXRyMWP8y%2FYvXAbKlj7oWgMiMKBRzZm06AHCQS6QxypQVYRnRzoaObrFWr%2FKyeoLZ7d%2FuMjoqNYFmDPT0onFub2Ac7CF4l0HdOe2YFhTwebS16Cb%2BVDkeM0fBtEKfCLqmR8JJhjI3r7%2Fd3dS6llElAvEVzTD1aZ4Mp34BEGfoJey%2FFqsAwUzctiYfOdqI%2FB%2BuiuJd9jYoW070tg31ARBY0qLhFxnczfi39RXoY6cA7vBFrxFkWYI5gq2Cpw0UPXOUnCxMZdOZGGPmS0vCJmMiH2AUIrFe91ZrDvY2HuW1f29BN1CLEiahi9hb6XSf7%2FxdcFAkk1rsoU3r%2FA7Fj%2FYDFY%2BNP3%2FNIpasF8mJZjtfFFfV%2FwkGlR3srVjZb94kpAyGrOPuepbpCtl98RLI%2B6hgA%2BEBRkp1PAB6O8JMYw0sI30sg4WP5BWXvMuFwkJ0T6haWl3oaHBRh32M5EWErFRfC%2Bp%2BAw%2B5XVzAY6pgHUhYqkjJecw8NbVmyhC0VirwB%2FFWUxf7b9ZhnVRxOpiKVtMLfJG49MXafJWGZyMjS08U8l6wTpjm4RbUPU9Tw8%2FCuCgRhmCxI6ZGwzR2%2BgapDrwok4AJR2xxK39hSC%2BNRQtBSKSn4wOVVFPVmmWhaH6Kgk77eZvdJRXShyFqUFvkBLb0ZlsxHo4371CFQLU4NNqmTD8edDnPosSaZFsJw3%2BcszENW3&X-Amz-Signature=fb41d3cc1d5fa552ed1094d1defa06b2904de7a3ade4c9a1d684ba3f378b07f9&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/4c6a7fb9-7776-424b-9439-48ae133a5c31/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466W2DDH772%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T055014Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIFyZraOBpLeWx2APj9XPRhdrWQf%2FjO6CP4SryJl7CGawAiAccmNVbm1GpQuVPDY99no8UXg5r8kjn0Ri%2FAYfdqGFBCr%2FAwheEAAaDDYzNzQyMzE4MzgwNSIM%2F0yMkECMl28HDBShKtwDWM%2FmljeKeT8tWyIHQ9RvmJDCiBC5GhTXXD6hUxml5stg43KajUHOwnOme%2BIG4Ip1u1eT9BQT1laJt9YFOOkg%2BzyEZZICWfsMTuyoqsq%2BcDRMhcBojqngoa3lj8Ze2Ypxd63VcEhkzmHXxDD3l8N3GvYxd%2FjvdiCh5xXRyMWP8y%2FYvXAbKlj7oWgMiMKBRzZm06AHCQS6QxypQVYRnRzoaObrFWr%2FKyeoLZ7d%2FuMjoqNYFmDPT0onFub2Ac7CF4l0HdOe2YFhTwebS16Cb%2BVDkeM0fBtEKfCLqmR8JJhjI3r7%2Fd3dS6llElAvEVzTD1aZ4Mp34BEGfoJey%2FFqsAwUzctiYfOdqI%2FB%2BuiuJd9jYoW070tg31ARBY0qLhFxnczfi39RXoY6cA7vBFrxFkWYI5gq2Cpw0UPXOUnCxMZdOZGGPmS0vCJmMiH2AUIrFe91ZrDvY2HuW1f29BN1CLEiahi9hb6XSf7%2FxdcFAkk1rsoU3r%2FA7Fj%2FYDFY%2BNP3%2FNIpasF8mJZjtfFFfV%2FwkGlR3srVjZb94kpAyGrOPuepbpCtl98RLI%2B6hgA%2BEBRkp1PAB6O8JMYw0sI30sg4WP5BWXvMuFwkJ0T6haWl3oaHBRh32M5EWErFRfC%2Bp%2BAw%2B5XVzAY6pgHUhYqkjJecw8NbVmyhC0VirwB%2FFWUxf7b9ZhnVRxOpiKVtMLfJG49MXafJWGZyMjS08U8l6wTpjm4RbUPU9Tw8%2FCuCgRhmCxI6ZGwzR2%2BgapDrwok4AJR2xxK39hSC%2BNRQtBSKSn4wOVVFPVmmWhaH6Kgk77eZvdJRXShyFqUFvkBLb0ZlsxHo4371CFQLU4NNqmTD8edDnPosSaZFsJw3%2BcszENW3&X-Amz-Signature=215a47aae6ff909a98cbef1e2f39995560f2cbbf6c210280b3e8ebe4dce15651&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

第一步，以uv的X最小值为轴点，向X的方向移动 负X最小值。

第二步，以uv的X最小值为轴点，缩放 1/X的最大值。

这里我们就实现了填充UV 0-1空间的功能。(这里我的Y轴为河流宽一直是UV.y 0 -1范围所以并不需要做uv.y方向的位移与缩放)


接下来我们便是准备重新输出我们的水片，这里我们需要把水片的名称Tag重新赋予水片，并且加上两个新Tag，一个为当前水片名称+切块Index的Tag，一个为当前地块名称的Tag，有了这几个Tag，我们之后的处理将会更方便。之后便是Pack起来，为Pack的时候可以随手将我们设置的Tag Transfer Attributes过去，方便之后更好操作。(注意如果是河流的话需要把引流线一起Pack)


