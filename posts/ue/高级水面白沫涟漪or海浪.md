---
title: "高级水面白沫涟漪OR海浪"
categories: ["UE"]
date: "2024-01-17"
created: "2024-01-17T03:34:00.000Z"
updated: "2024-01-17T03:35:00.000Z"
notion_url: "https://www.notion.so/OR-5283a0595cae4f42b88b2552302427e4"
database: "UE Technical"
---


![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/50a55adf-4328-4aa7-9cbd-0996337cd659/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QPLKHQ3N%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T054940Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBL0lt3aBZxWW%2FLpY14wA%2B9UZ1m9KrKPoAAKcZT5NHZJAiEArAi3A1NQX8nbgIjI0BdZh2wWn%2BUmhAZ9zVswPhejyiQq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDDZ3TRFGcc9pNPEk5CrcAzBfG20V68zWJmJlwTCS1fXUuLwqpxW4y7WHGL6TYuWQCY6%2Fl%2BCoYx3U%2F1E5ZXU92rV5aK%2FeugR67LLVukVh5ks6h5SFS2Isq8nFKYN1O5tsc7jeA6peRWRR7RXIM%2Bl4DgAp9d1WxvOMJ8sFFYCKVi%2FRPRjr2Jne5%2FgulHS6KQjaFYLauFPaW1H07hzx7QytseZwUTOL5C61ipkxHoQSfO7XYRULVaZWv164M5jCg4roZSBxwUZLqfjJVWYKiDwjIwtgh4EPpP5xg5oLE01oqgR3OxeAk7PEylbih6YKXlRvwezjxH4QtBBN0jzgzgOLqGNsWxe4SwdqjHJt1z6fQaXLLzVb4PFstYnOrpv6iUVU2tdtQNpEdWNx7GOwvSyjHi2kXpj6Tk0Yhy10K2tkI5zdM8zPZbr1Ss1u2%2BvQ%2BFK96hK8hTOn5csufItCdPQB18jfy9PhWkFvZ9krIFxSekuSkSdnRNKR722vvgsEiMGiiemcIWsNUnlJvuTNcedcIKI%2Bb7nmqxR%2FSQ8QfwYrfuVKgmJiI6JOtUMKH94oQ8AJ13SUCf0KmauQqcuw84Ix9JuzhSk4dMxTknibqZabsJWkHgBDNyNTSZmaGPtG%2B0eOnhkeII6EdZ5ljYCyMOqV1cwGOqUBZP93shJ4ywXnL32wpyCYLla5QqrwIKaRQ5hMeO%2FUFiKkwtaHm5NRRL%2BBJQy1ne1a7g3mJzH4EosDWEXevGFD5%2FTon6KzMKy%2Fpf4qdo%2BJma6vfX8KL23pwDdIzkcXSp822uNtSCzRKdDHdOoIdXcjCU0%2FO2e0e0BK75f6JCnTUmjhVS8FqvV8diRUiwGLRtsCOqffZ01A0hKAeaGNEYUmBXGYgtcM&X-Amz-Signature=7c55f840700edc338193ec74158ee9a18ebc25f5af08331c5aaa400221c97205&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

这是我们传统的通过水面当前像素深度、世界坐标位置、场景深度、相机位置求得一个稳定的水面深度，深度有两种，一种是从摄像机出发的深度，另一种则是垂直深度。这里我们求的为垂直深度。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/22482f8e-334a-45fd-9d05-2220191f31e1/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QPLKHQ3N%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T054940Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBL0lt3aBZxWW%2FLpY14wA%2B9UZ1m9KrKPoAAKcZT5NHZJAiEArAi3A1NQX8nbgIjI0BdZh2wWn%2BUmhAZ9zVswPhejyiQq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDDZ3TRFGcc9pNPEk5CrcAzBfG20V68zWJmJlwTCS1fXUuLwqpxW4y7WHGL6TYuWQCY6%2Fl%2BCoYx3U%2F1E5ZXU92rV5aK%2FeugR67LLVukVh5ks6h5SFS2Isq8nFKYN1O5tsc7jeA6peRWRR7RXIM%2Bl4DgAp9d1WxvOMJ8sFFYCKVi%2FRPRjr2Jne5%2FgulHS6KQjaFYLauFPaW1H07hzx7QytseZwUTOL5C61ipkxHoQSfO7XYRULVaZWv164M5jCg4roZSBxwUZLqfjJVWYKiDwjIwtgh4EPpP5xg5oLE01oqgR3OxeAk7PEylbih6YKXlRvwezjxH4QtBBN0jzgzgOLqGNsWxe4SwdqjHJt1z6fQaXLLzVb4PFstYnOrpv6iUVU2tdtQNpEdWNx7GOwvSyjHi2kXpj6Tk0Yhy10K2tkI5zdM8zPZbr1Ss1u2%2BvQ%2BFK96hK8hTOn5csufItCdPQB18jfy9PhWkFvZ9krIFxSekuSkSdnRNKR722vvgsEiMGiiemcIWsNUnlJvuTNcedcIKI%2Bb7nmqxR%2FSQ8QfwYrfuVKgmJiI6JOtUMKH94oQ8AJ13SUCf0KmauQqcuw84Ix9JuzhSk4dMxTknibqZabsJWkHgBDNyNTSZmaGPtG%2B0eOnhkeII6EdZ5ljYCyMOqV1cwGOqUBZP93shJ4ywXnL32wpyCYLla5QqrwIKaRQ5hMeO%2FUFiKkwtaHm5NRRL%2BBJQy1ne1a7g3mJzH4EosDWEXevGFD5%2FTon6KzMKy%2Fpf4qdo%2BJma6vfX8KL23pwDdIzkcXSp822uNtSCzRKdDHdOoIdXcjCU0%2FO2e0e0BK75f6JCnTUmjhVS8FqvV8diRUiwGLRtsCOqffZ01A0hKAeaGNEYUmBXGYgtcM&X-Amz-Signature=aa7062e9d859301a130c4c70d1631311304cd6074e3f93745875995837380663&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

（这里我用的SingleLayerWater，得到场景深度的节点为SceneDepthWithoutWater，正常半透明用SceneDepth）

注意：SingleLayerWater的深度图存在降采样与半精度问题

r.Water.SingleLayer.RefractionDownsampleFactor 1

r.Water.SingleLayer.RefractionFullPrecision 1

实际使用需要在代码里面更改一下默认值。我这里已经改过了。

得到水的深度这个线性值之后，便是捏水波或者说白沫的形状了，这部分全靠自己调整一下波形的相位、周期、振幅这些，而且也不局限于Sin波，只需要是连续可导的就行，有点像自己捏一个噪声。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/53a1cb24-5ce6-4ff5-bbf5-193836842bf9/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QPLKHQ3N%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T054940Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBL0lt3aBZxWW%2FLpY14wA%2B9UZ1m9KrKPoAAKcZT5NHZJAiEArAi3A1NQX8nbgIjI0BdZh2wWn%2BUmhAZ9zVswPhejyiQq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDDZ3TRFGcc9pNPEk5CrcAzBfG20V68zWJmJlwTCS1fXUuLwqpxW4y7WHGL6TYuWQCY6%2Fl%2BCoYx3U%2F1E5ZXU92rV5aK%2FeugR67LLVukVh5ks6h5SFS2Isq8nFKYN1O5tsc7jeA6peRWRR7RXIM%2Bl4DgAp9d1WxvOMJ8sFFYCKVi%2FRPRjr2Jne5%2FgulHS6KQjaFYLauFPaW1H07hzx7QytseZwUTOL5C61ipkxHoQSfO7XYRULVaZWv164M5jCg4roZSBxwUZLqfjJVWYKiDwjIwtgh4EPpP5xg5oLE01oqgR3OxeAk7PEylbih6YKXlRvwezjxH4QtBBN0jzgzgOLqGNsWxe4SwdqjHJt1z6fQaXLLzVb4PFstYnOrpv6iUVU2tdtQNpEdWNx7GOwvSyjHi2kXpj6Tk0Yhy10K2tkI5zdM8zPZbr1Ss1u2%2BvQ%2BFK96hK8hTOn5csufItCdPQB18jfy9PhWkFvZ9krIFxSekuSkSdnRNKR722vvgsEiMGiiemcIWsNUnlJvuTNcedcIKI%2Bb7nmqxR%2FSQ8QfwYrfuVKgmJiI6JOtUMKH94oQ8AJ13SUCf0KmauQqcuw84Ix9JuzhSk4dMxTknibqZabsJWkHgBDNyNTSZmaGPtG%2B0eOnhkeII6EdZ5ljYCyMOqV1cwGOqUBZP93shJ4ywXnL32wpyCYLla5QqrwIKaRQ5hMeO%2FUFiKkwtaHm5NRRL%2BBJQy1ne1a7g3mJzH4EosDWEXevGFD5%2FTon6KzMKy%2Fpf4qdo%2BJma6vfX8KL23pwDdIzkcXSp822uNtSCzRKdDHdOoIdXcjCU0%2FO2e0e0BK75f6JCnTUmjhVS8FqvV8diRUiwGLRtsCOqffZ01A0hKAeaGNEYUmBXGYgtcM&X-Amz-Signature=af8314476d38ee7dd9ad9cb9c81700e2fe7212bed4a3f84de8d0665a14f800b3&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

为了展示这种方法会出现的问题，这里我简单给个sin做示范。

可以看见在这种深度渐变比较均匀的地形上，这个方法是比较不错的，而且视角的变动也不会影响水波。

但是，如果在深度渐变不均匀的地形或者场景中，就特别容易发生白沫大面积出现的问题。

出现这个问题的原因就是大面积的斜率过小，导致大面积的深度值一样，同时出现白沫。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/a55d951e-6d18-4885-b0ee-3799b11f2b37/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QPLKHQ3N%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T054940Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBL0lt3aBZxWW%2FLpY14wA%2B9UZ1m9KrKPoAAKcZT5NHZJAiEArAi3A1NQX8nbgIjI0BdZh2wWn%2BUmhAZ9zVswPhejyiQq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDDZ3TRFGcc9pNPEk5CrcAzBfG20V68zWJmJlwTCS1fXUuLwqpxW4y7WHGL6TYuWQCY6%2Fl%2BCoYx3U%2F1E5ZXU92rV5aK%2FeugR67LLVukVh5ks6h5SFS2Isq8nFKYN1O5tsc7jeA6peRWRR7RXIM%2Bl4DgAp9d1WxvOMJ8sFFYCKVi%2FRPRjr2Jne5%2FgulHS6KQjaFYLauFPaW1H07hzx7QytseZwUTOL5C61ipkxHoQSfO7XYRULVaZWv164M5jCg4roZSBxwUZLqfjJVWYKiDwjIwtgh4EPpP5xg5oLE01oqgR3OxeAk7PEylbih6YKXlRvwezjxH4QtBBN0jzgzgOLqGNsWxe4SwdqjHJt1z6fQaXLLzVb4PFstYnOrpv6iUVU2tdtQNpEdWNx7GOwvSyjHi2kXpj6Tk0Yhy10K2tkI5zdM8zPZbr1Ss1u2%2BvQ%2BFK96hK8hTOn5csufItCdPQB18jfy9PhWkFvZ9krIFxSekuSkSdnRNKR722vvgsEiMGiiemcIWsNUnlJvuTNcedcIKI%2Bb7nmqxR%2FSQ8QfwYrfuVKgmJiI6JOtUMKH94oQ8AJ13SUCf0KmauQqcuw84Ix9JuzhSk4dMxTknibqZabsJWkHgBDNyNTSZmaGPtG%2B0eOnhkeII6EdZ5ljYCyMOqV1cwGOqUBZP93shJ4ywXnL32wpyCYLla5QqrwIKaRQ5hMeO%2FUFiKkwtaHm5NRRL%2BBJQy1ne1a7g3mJzH4EosDWEXevGFD5%2FTon6KzMKy%2Fpf4qdo%2BJma6vfX8KL23pwDdIzkcXSp822uNtSCzRKdDHdOoIdXcjCU0%2FO2e0e0BK75f6JCnTUmjhVS8FqvV8diRUiwGLRtsCOqffZ01A0hKAeaGNEYUmBXGYgtcM&X-Amz-Signature=69fae3e0a32db2ab831d836ed289b65b4ff90b0e0045199e81e652b3fdef9c46&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

就如此图一样。

如何避免这类问题，以下为个人思考和经验，既然确定这个问题是由于斜率过小不合适导致的，那我们应该屏蔽这类斜率过小的区域。但是仅仅根据已知的这几个信息无法知道斜率，所以大部分人都会选择烘焙一张垂直的拍摄的信息图，像SDF或者法线这些。

然而我像做一个通用的效果，并不想去烘焙这些信息，在这个前提下，该怎么拿到水面下的场景深度斜率，这里就会想到用DDX与DDY去拿到当前深度与周围的深度的变化率，就可以算得当前点的法线，归一化的法线的Y轴便是当前点的斜率大小。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/9f802bee-e716-4213-bfec-257467388716/Untitled.jpeg?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QPLKHQ3N%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T054940Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBL0lt3aBZxWW%2FLpY14wA%2B9UZ1m9KrKPoAAKcZT5NHZJAiEArAi3A1NQX8nbgIjI0BdZh2wWn%2BUmhAZ9zVswPhejyiQq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDDZ3TRFGcc9pNPEk5CrcAzBfG20V68zWJmJlwTCS1fXUuLwqpxW4y7WHGL6TYuWQCY6%2Fl%2BCoYx3U%2F1E5ZXU92rV5aK%2FeugR67LLVukVh5ks6h5SFS2Isq8nFKYN1O5tsc7jeA6peRWRR7RXIM%2Bl4DgAp9d1WxvOMJ8sFFYCKVi%2FRPRjr2Jne5%2FgulHS6KQjaFYLauFPaW1H07hzx7QytseZwUTOL5C61ipkxHoQSfO7XYRULVaZWv164M5jCg4roZSBxwUZLqfjJVWYKiDwjIwtgh4EPpP5xg5oLE01oqgR3OxeAk7PEylbih6YKXlRvwezjxH4QtBBN0jzgzgOLqGNsWxe4SwdqjHJt1z6fQaXLLzVb4PFstYnOrpv6iUVU2tdtQNpEdWNx7GOwvSyjHi2kXpj6Tk0Yhy10K2tkI5zdM8zPZbr1Ss1u2%2BvQ%2BFK96hK8hTOn5csufItCdPQB18jfy9PhWkFvZ9krIFxSekuSkSdnRNKR722vvgsEiMGiiemcIWsNUnlJvuTNcedcIKI%2Bb7nmqxR%2FSQ8QfwYrfuVKgmJiI6JOtUMKH94oQ8AJ13SUCf0KmauQqcuw84Ix9JuzhSk4dMxTknibqZabsJWkHgBDNyNTSZmaGPtG%2B0eOnhkeII6EdZ5ljYCyMOqV1cwGOqUBZP93shJ4ywXnL32wpyCYLla5QqrwIKaRQ5hMeO%2FUFiKkwtaHm5NRRL%2BBJQy1ne1a7g3mJzH4EosDWEXevGFD5%2FTon6KzMKy%2Fpf4qdo%2BJma6vfX8KL23pwDdIzkcXSp822uNtSCzRKdDHdOoIdXcjCU0%2FO2e0e0BK75f6JCnTUmjhVS8FqvV8diRUiwGLRtsCOqffZ01A0hKAeaGNEYUmBXGYgtcM&X-Amz-Signature=27bfc85f9e071eb3a95d60adb95cceacf31b37f09cfce8def1ecc5f758425de7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

这一步，我们便是使用当前水底点的世界空间坐标去和周围水底点世界空间坐标去做DDX与DDY得到当前点的水底世界空间法线。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/966e24b5-f29d-4e19-9a56-d9ff16ebffe7/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QPLKHQ3N%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T054940Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBL0lt3aBZxWW%2FLpY14wA%2B9UZ1m9KrKPoAAKcZT5NHZJAiEArAi3A1NQX8nbgIjI0BdZh2wWn%2BUmhAZ9zVswPhejyiQq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDDZ3TRFGcc9pNPEk5CrcAzBfG20V68zWJmJlwTCS1fXUuLwqpxW4y7WHGL6TYuWQCY6%2Fl%2BCoYx3U%2F1E5ZXU92rV5aK%2FeugR67LLVukVh5ks6h5SFS2Isq8nFKYN1O5tsc7jeA6peRWRR7RXIM%2Bl4DgAp9d1WxvOMJ8sFFYCKVi%2FRPRjr2Jne5%2FgulHS6KQjaFYLauFPaW1H07hzx7QytseZwUTOL5C61ipkxHoQSfO7XYRULVaZWv164M5jCg4roZSBxwUZLqfjJVWYKiDwjIwtgh4EPpP5xg5oLE01oqgR3OxeAk7PEylbih6YKXlRvwezjxH4QtBBN0jzgzgOLqGNsWxe4SwdqjHJt1z6fQaXLLzVb4PFstYnOrpv6iUVU2tdtQNpEdWNx7GOwvSyjHi2kXpj6Tk0Yhy10K2tkI5zdM8zPZbr1Ss1u2%2BvQ%2BFK96hK8hTOn5csufItCdPQB18jfy9PhWkFvZ9krIFxSekuSkSdnRNKR722vvgsEiMGiiemcIWsNUnlJvuTNcedcIKI%2Bb7nmqxR%2FSQ8QfwYrfuVKgmJiI6JOtUMKH94oQ8AJ13SUCf0KmauQqcuw84Ix9JuzhSk4dMxTknibqZabsJWkHgBDNyNTSZmaGPtG%2B0eOnhkeII6EdZ5ljYCyMOqV1cwGOqUBZP93shJ4ywXnL32wpyCYLla5QqrwIKaRQ5hMeO%2FUFiKkwtaHm5NRRL%2BBJQy1ne1a7g3mJzH4EosDWEXevGFD5%2FTon6KzMKy%2Fpf4qdo%2BJma6vfX8KL23pwDdIzkcXSp822uNtSCzRKdDHdOoIdXcjCU0%2FO2e0e0BK75f6JCnTUmjhVS8FqvV8diRUiwGLRtsCOqffZ01A0hKAeaGNEYUmBXGYgtcM&X-Amz-Signature=64d2545c046adf66a0582c76130d60b7aa126c5076590265154f5783fec62647&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

法线为-1到1大小，所以有部分为黑色。因为地形本身就是格子，一个地形面片内的法线是固定的，所以看起来结果是这样的，目前可以确认是正确的。

现在我们只需要屏蔽掉不合适的区域既可以。

![](https://prod-files-secure.s3.us-west-2.amazonaws.com/826ac7c4-16ea-47db-b704-f30f496469c3/1a3e1881-4d49-481f-86bf-a0ac6672a96c/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QPLKHQ3N%2F20260218%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20260218T054940Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJX%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIBL0lt3aBZxWW%2FLpY14wA%2B9UZ1m9KrKPoAAKcZT5NHZJAiEArAi3A1NQX8nbgIjI0BdZh2wWn%2BUmhAZ9zVswPhejyiQq%2FwMIXhAAGgw2Mzc0MjMxODM4MDUiDDZ3TRFGcc9pNPEk5CrcAzBfG20V68zWJmJlwTCS1fXUuLwqpxW4y7WHGL6TYuWQCY6%2Fl%2BCoYx3U%2F1E5ZXU92rV5aK%2FeugR67LLVukVh5ks6h5SFS2Isq8nFKYN1O5tsc7jeA6peRWRR7RXIM%2Bl4DgAp9d1WxvOMJ8sFFYCKVi%2FRPRjr2Jne5%2FgulHS6KQjaFYLauFPaW1H07hzx7QytseZwUTOL5C61ipkxHoQSfO7XYRULVaZWv164M5jCg4roZSBxwUZLqfjJVWYKiDwjIwtgh4EPpP5xg5oLE01oqgR3OxeAk7PEylbih6YKXlRvwezjxH4QtBBN0jzgzgOLqGNsWxe4SwdqjHJt1z6fQaXLLzVb4PFstYnOrpv6iUVU2tdtQNpEdWNx7GOwvSyjHi2kXpj6Tk0Yhy10K2tkI5zdM8zPZbr1Ss1u2%2BvQ%2BFK96hK8hTOn5csufItCdPQB18jfy9PhWkFvZ9krIFxSekuSkSdnRNKR722vvgsEiMGiiemcIWsNUnlJvuTNcedcIKI%2Bb7nmqxR%2FSQ8QfwYrfuVKgmJiI6JOtUMKH94oQ8AJ13SUCf0KmauQqcuw84Ix9JuzhSk4dMxTknibqZabsJWkHgBDNyNTSZmaGPtG%2B0eOnhkeII6EdZ5ljYCyMOqV1cwGOqUBZP93shJ4ywXnL32wpyCYLla5QqrwIKaRQ5hMeO%2FUFiKkwtaHm5NRRL%2BBJQy1ne1a7g3mJzH4EosDWEXevGFD5%2FTon6KzMKy%2Fpf4qdo%2BJma6vfX8KL23pwDdIzkcXSp822uNtSCzRKdDHdOoIdXcjCU0%2FO2e0e0BK75f6JCnTUmjhVS8FqvV8diRUiwGLRtsCOqffZ01A0hKAeaGNEYUmBXGYgtcM&X-Amz-Signature=c001fd2a3cfc1c6cab3d59b8b1eb9b1da51529731f2d075f10fb9348f8d629f4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

这里我就屏蔽了斜率小于一定阈值的区域。最后就可以得到正确的效果啦。

剩下还没有有调整白沫形状函数的细节，我就不过多介绍啦，很多地方都有。具体可以看https://zhuanlan.zhihu.com/p/63722738

